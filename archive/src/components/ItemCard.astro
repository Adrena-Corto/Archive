---
import type { Item } from '../lib/items';

interface Props {
  item: Item;
}

const { item } = Astro.props;
const imagePath = item.images[0] ? `/images/items/${item.id}/${item.images[0]}` : null;

const categoryLabels: Record<Item['category'], string> = {
  coin: 'COIN',
  jewelry: 'JEWELRY',
  ring: 'RING',
  seal: 'SEAL',
  misc: 'MISC',
};
---

<a
  href={`${import.meta.env.BASE_URL}/item/${item.id}`}
  class="group block glass-panel-solid overflow-hidden card-hover"
  data-category={item.category}
  data-material={item.material}
  data-period={item.period}
>
  <div class="aspect-[4/3] bg-surface-light overflow-hidden relative">
    {imagePath ? (
      <div class="relative w-full h-full">
        <div class="absolute inset-0 skeleton-pulse"></div>
        <img
          src={imagePath}
          alt={item.name}
          class="img-fade-in w-full h-full object-cover opacity-90 group-hover:opacity-100 group-hover:scale-105 transition-all duration-500"
          loading="lazy"
          onload="this.classList.add('loaded')"
          onerror="this.parentElement.innerHTML = '<div class=\'w-full h-full flex flex-col items-center justify-center gap-2\'><svg class=\'w-8 h-8 text-text-dim\' fill=\'none\' stroke=\'currentColor\' viewBox=\'0 0 24 24\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1.5\' d=\'M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z\'/></svg><span class=\'font-mono text-[10px] text-text-dim uppercase tracking-wider\'>Image unavailable</span></div>'"
        />
      </div>
    ) : (
      <div class="w-full h-full flex flex-col items-center justify-center gap-2 bg-surface">
        <svg class="w-8 h-8 text-text-dim" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span class="font-mono text-[10px] text-text-dim uppercase tracking-wider">No Image</span>
      </div>
    )}
    <div class="absolute inset-0 bg-gradient-to-t from-surface/80 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" />
  </div>

  <div class="p-4 space-y-3">
    <div class="flex items-center gap-2">
      <span class="font-mono text-[10px] uppercase tracking-wider text-accent">
        {categoryLabels[item.category]}
      </span>
      <span class="text-text-dim">Â·</span>
      <span class="font-mono text-[10px] uppercase tracking-wider text-text-dim">
        {item.period}
      </span>
    </div>

    <div class="border-t border-border pt-3">
      <h3 class="text-lg text-text leading-tight group-hover:text-accent transition-colors duration-300">
        {item.name}
      </h3>
    </div>

    <div class="space-y-1.5 pt-2">
      <div class="flex items-center justify-between">
        <span class="data-label">Era</span>
        <span class="data-value">{item.era}</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="data-label">Material</span>
        <span class="data-value capitalize">{item.material}</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="data-label">Origin</span>
        <span class="data-value">{item.origin}</span>
      </div>
      {item.weight && (
        <div class="flex items-center justify-between">
          <span class="data-label">Weight</span>
          <span class="data-value">{item.weight}</span>
        </div>
      )}
    </div>
  </div>
</a>
