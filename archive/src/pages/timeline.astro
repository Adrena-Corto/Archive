---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getAllItems } from '../lib/items';

const items = getAllItems();

const base = import.meta.env.BASE_URL;
function url(path: string): string {
  return `${base}${path}`.replace(/\/+/g, '/');
}

const timelinePeriods = [
  { name: 'Ancient Near East', range: '3000 BC - 500 BC', items: items.filter(i => i.period.includes('Akkadian') || i.period.includes('Sumerian') || i.period.includes('Mesopotam')) },
  { name: 'Classical Greek', range: '500 BC - 323 BC', items: items.filter(i => i.period.includes('Greek') || i.period.includes('Helleni')) },
  { name: 'Roman', range: '500 BC - 476 AD', items: items.filter(i => i.period.includes('Roman')) },
  { name: 'Byzantine', range: '330 AD - 1453 AD', items: items.filter(i => i.period.includes('Byzantine')) },
  { name: 'Medieval', range: '500 AD - 1500 AD', items: items.filter(i => i.period.includes('Medieval')) },
  { name: 'Modern', range: '1500 AD - Present', items: items.filter(i => i.period.includes('Modern')) },
].filter(p => p.items.length > 0);
---

<BaseLayout title="Timeline | Archive">
  <section class="relative py-16">
    <div class="absolute inset-0 bg-gradient-to-b from-surface/30 to-void pointer-events-none" />

    <div class="container-narrow relative">
      <div class="mb-12">
        <p class="font-mono text-xs uppercase tracking-[0.2em] text-accent mb-3">
          // Temporal Index
        </p>
        <h1 class="text-4xl md:text-5xl text-text mb-4">Timeline</h1>
        <p class="text-text-muted text-lg">
          Explore the collection through the ages.
        </p>
      </div>

      <div class="relative">
        <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-px bg-accent/30"></div>

        {timelinePeriods.map((period, index) => (
          <div class={`relative mb-16 ${index % 2 === 0 ? 'md:pr-1/2 md:text-right' : 'md:pl-1/2 md:ml-auto'}`}>
            <div class="absolute left-4 md:left-1/2 w-3 h-3 bg-accent rounded-full -translate-x-1.5 shadow-glow-cyan"></div>

            <div class={`ml-12 md:ml-0 ${index % 2 === 0 ? 'md:mr-12' : 'md:ml-12'}`}>
              <p class="font-mono text-xs uppercase tracking-widest text-accent mb-1">{period.range}</p>
              <h2 class="text-2xl text-text mb-4">{period.name}</h2>

              <div class={`grid gap-3 ${index % 2 === 0 ? 'md:justify-end' : ''}`}>
                {period.items.map((item) => (
                  <a
                    href={url(`/item/${item.id}`)}
                    class="block glass-panel p-4 card-hover max-w-sm"
                  >
                    <p class="text-lg text-text group-hover:text-accent transition-colors">{item.name}</p>
                    <p class="font-mono text-xs text-text-dim mt-1">{item.era}</p>
                  </a>
                ))}
              </div>
            </div>
          </div>
        ))}

        {timelinePeriods.length === 0 && (
          <div class="text-center py-20">
            <p class="text-lg text-text-dim font-mono">// No temporal data available</p>
          </div>
        )}
      </div>
    </div>
  </section>
</BaseLayout>
