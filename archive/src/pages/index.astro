---
import BaseLayout from '../layouts/BaseLayout.astro';
import ItemGrid from '../components/ItemGrid.astro';
import { getFeaturedItems, getAllItems } from '../lib/items';

const featuredItems = getFeaturedItems();
const allItems = getAllItems();
const displayItems = featuredItems.length > 0 ? featuredItems : allItems.slice(0, 6);

const base = import.meta.env.BASE_URL;
function url(path: string): string {
  return `${base}${path}`.replace(/\/+/g, '/');
}

const buttonText = "Browse Collection";
const cuneiformMap: Record<string, string> = {
  'B': 'ð’€', 'R': 'ð’Š‘', 'O': 'ð’Œ‹', 'W': 'ð’‰¿', 'S': 'ð’Š“', 'E': 'ð’‚Š',
  'C': 'ð’‹»', 'L': 'ð’‡·', 'T': 'ð’Œ…', 'I': 'ð’„¿', 'N': 'ð’ˆ¾',
  'b': 'ð’€', 'r': 'ð’Š‘', 'o': 'ð’Œ‹', 'w': 'ð’‰¿', 's': 'ð’Š“', 'e': 'ð’‚Š',
  'c': 'ð’‹»', 'l': 'ð’‡·', 't': 'ð’Œ…', 'i': 'ð’„¿', 'n': 'ð’ˆ¾',
  ' ': ' '
};

const characters = buttonText.split('').map(char => ({
  en: char,
  cu: cuneiformMap[char] || char
}));

const shuffledIndices = [...Array(characters.length).keys()]
  .sort(() => Math.random() - 0.5);
const delayMap = shuffledIndices.map((_, i) => shuffledIndices.indexOf(i) * 50);
---

<BaseLayout title="Archive | Historical Collection">
  <section class="relative min-h-[70vh] flex items-center justify-center overflow-hidden">
    <div class="relative text-center px-6 max-w-4xl mx-auto">
      <p class="font-mono text-xs uppercase tracking-[0.3em] text-accent mb-6">
        // Personal Archive System v1.0
      </p>
      <h1 class="text-5xl md:text-7xl lg:text-8xl tracking-tight text-text mb-8">
        The Archive
      </h1>
      <p class="text-lg md:text-xl text-text-muted max-w-2xl mx-auto mb-16 leading-relaxed">
        Coins that changed hands in forgotten markets. Rings worn by the nameless. Seals pressed into clay before writing had a name. An archive of the intimately ancient.
      </p>
      <a
        href={url('/collection')}
        class="decipher-btn glass-panel-solid px-10 py-4 font-mono text-base uppercase tracking-wider text-text hover:text-accent hover:border-accent/50 transition-all duration-300"
        aria-label="Browse Collection"
        data-matrix-light="1"
      >
        <span class="text-accent">></span>
        <span class="decipher-text">
          {characters.map((char, i) => (
            <span class={`decipher-char${char.en === ' ' ? ' space' : ''}`} style={`--delay: ${delayMap[i]}ms`}>
              <span class="char-cuneiform">{char.cu}</span>
              <span class="char-english">{char.en}</span>
            </span>
          ))}
        </span>
      </a>
    </div>

  </section>

  <section class="container-narrow py-20">
    <div class="flex items-end justify-between mb-10">
      <div>
        <p class="font-mono text-xs uppercase tracking-wider text-accent mb-2">// Featured</p>
        <h2 class="text-3xl md:text-4xl text-text">Recent Acquisitions</h2>
      </div>
      <a href={url('/collection')} class="link-glow font-mono text-xs uppercase tracking-wider">
        View All <span class="text-accent">â†’</span>
      </a>
    </div>

    <ItemGrid items={displayItems} columns={3} />
  </section>

  <section class="border-t border-white/5 py-20">
    <div class="container-narrow">
      <div class="grid md:grid-cols-3 gap-8">
        <div class="glass-panel p-6 text-center">
          <p class="font-mono text-4xl text-accent mb-2">{allItems.length}</p>
          <p class="font-mono text-xs uppercase tracking-wider text-text-dim">Items Catalogued</p>
        </div>
        <div class="glass-panel p-6 text-center">
          <p class="font-mono text-4xl text-accent mb-2">5000+</p>
          <p class="font-mono text-xs uppercase tracking-wider text-text-dim">Years of History</p>
        </div>
        <div class="glass-panel p-6 text-center">
          <p class="font-mono text-4xl text-accent mb-2">5</p>
          <p class="font-mono text-xs uppercase tracking-wider text-text-dim">Categories</p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
